<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
    <meta charset="utf-8">
    <title>canvas</title>
  </head>
  <body>
    <h2> The demographics of data vizualizers</h2>
    <p>Some text goes here.</p>
    <div class="section" id="section-where" onclick="toggleCountryVisble();">
      Where are data visualizers from?
      <center><div id="country" class="viz">
        <p>Most people who answered the survey were from USA (670), UK (99) or Canada (62). India was at the fourth position with 42.</p>

      </div></center>
    </div>

    <div class="section" id="section-tools" onclick="toggleToolsVisble();">
      What TOOLS do data visualizers use to create data visualization?
      <div id="tools" class="viz">
        <p>Is this working?</p>
      </div>
    </div>

    <script>

    document.getElementById('tag-id').innerHTML = '<ol><li>html data</li></ol>';
    </script>

  </body>
  <script>

//Plotly stuff starts here.

  Plotly.d3.csv('http://gyanl.com/dvs-challenge/countries.csv', function(err, rows){
    function unpack(rows, key) {
        return rows.map(function(row) { return row[key]; });
    }

  var data = [{
      type: 'choropleth',
      locationmode: 'country names',
      locations: unpack(rows, 'country'),
      z: unpack(rows, 'people'),
      text: unpack(rows, 'country'),
      autocolorscale: true
  }];

  var layout = {
    title: '',
    geo: {
        projection: {
            type: 'robinson'
        }
    }
  };

  Plotly.plot(country, data, layout, {showLink: false});

});

//Gyan's shitty code starts here.

    var tools = document.getElementById("tools");
    var country = document.getElementById("country");

    function toggleCountryVisble() {
      country.classList.add("active");
      tools.classList.remove("active");
    };

    function toggleToolsVisble() {
      country.classList.remove("active");
      tools.classList.add("active");
    };






// Rishi's slightly less shitty code

var sections = {

window.onscroll = function() {

    var chapterNames = Object.keys(chapters);
    for (var i = 0; i < chapterNames.length; i++) {
        var chapterName = chapterNames[i];

        if (isElementOnScreen(chapterName)) {

          if(chapterName == 'opening')
          {
            console.log('Peekaboo');
          }
            setActiveChapter(chapterName);
            break;
        }
    }
};

var activeChapterName = 'starter';

function setActiveChapter(chapterName) {

    if (chapterName == activeChapterName) return;

    map.flyTo(chapters[chapterName]);

    document.getElementById(chapterName).setAttribute('class', 'active');
    document.getElementById(activeChapterName).setAttribute('class', '');

    setActiveLayers(chapterName);
    activeChapterName = chapterName;

}

function isElementOnScreen(id) {
    var element = document.getElementById(id);
    var bounds = element.getBoundingClientRect();
    return (bounds.top < (window.innerHeight/2) && (bounds.bottom > 0) && (bounds.bottom > (window.innerHeight/2 )));
}


  </script>
</html>
